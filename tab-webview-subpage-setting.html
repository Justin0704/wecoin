<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>个人资料</title>
    <script src="js/mui.min.js"></script>
    <script type="text/javascript" src="js/header.js" ></script>
    <script type="text/javascript" src="js/appToken.js" ></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <style type="text/css">
    	/*.mui-content{margin: 12px;}*/
    	.mui-btn{width: 95%;}
    	.mui-bar{background-color: #108EE9;height: 65px;}
    	.mui-row{background-color: #108EE9;}
		.mui-title{color: #FFFFFF;line-height: 75px;}
		.mui-table-view.mui-grid-9{
		    background-color: #108EE9;
		}
		.mui-grid-view.mui-grid-9 .mui-table-view-cell{
			border-right: 1px solid #108EE9;
    		border-bottom: 1px solid #108EE9;
		}
		.mui-grid-view.mui-grid-9{
			border-top: 1px solid #108EE9;
    		border-left: 1px solid #108EE9;
		}
		.mui-grid-view.mui-grid-9 .mui-media{
			color: #FFFFFF;
		}
		.mui-bar-nav {
			box-shadow: 0 1px 6px #108EE9;
		}
		.mui-scroll-wrapper {
			top: 15px;
		}
		/*.mui-pull-top-pocket {
			font-size: 8px;
			background-color: #108EE9;
		}
		.mui-pull {
			background-color: #108EE9;
		}*/
    </style>
</head>
<body>
	
	<header class="mui-bar mui-bar-nav">
		<h1 id="title" class="mui-title">我的</h1>
	</header>
	<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
		<div class="mui-scroll">
		
			<div class="mui-row" style="background-color: #108EE9;">
				<ul class="mui-table-view mui-grid-view mui-grid-9">
					<li class="mui-table-view-cell mui-media mui-col-sm-6 mui-col-xs-4">
						<div class="mui-media-body mui-h4" style="color:#FFFFFF;font-size: 12px;">上级ID</div>
						<span class="mui-h4" id="parentUserNo"></span>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-sm-6 mui-col-xs-4">
						<div class="mui-media-body mui-h4" style="color:#FFFFFF;font-size: 12px;">我的ID</div>
						<span class="mui-h4" id="userNo"></span>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-sm-6 mui-col-xs-4">
						<div class="mui-media-body mui-h4" style="color:#FFFFFF;font-size: 12px;">等级</div>
						<span class="mui-h4" id="level"></span>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-sm-6 mui-col-xs-4">
						<div class="mui-media-body mui-h4" style="color:#FFFFFF;font-size: 12px;">资产总额</div>
						<span class="mui-h4" id="virtualCoinCount">0</span>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-sm-6 mui-col-xs-4">
						<div class="mui-media-body mui-h4" style="color:#FFFFFF;font-size: 12px;">可用WBT</div>
						<span class="mui-h4" id="availableCount">0</span>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-sm-6 mui-col-xs-4">
						<div class="mui-media-body mui-h4" style="color:#FFFFFF;font-size: 12px;">冻结WBT</div>
						<span class="mui-h4" id="freezeCount">0</span>
					</li>
				</ul>
			</div>
			<div id="setting">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell">
						<!--<a class="mui-navigate-right">
							手机号验证
						</a>-->
						<div class="mui-table">
							<div class="mui-table-cell mui-col-xs-12">
								<h5>手机号认证</h5>
							</div>
							<div class="mui-table-cell mui-col-xs-7 mui-text-right">
			                    <span class="mui-h5" id="mobileNo"></span>
			                </div>
			                <div class="mui-table-cell mui-col-xs-5 mui-text-right">
			                    <span class="mui-h5"><button type="button" id="btnVerificationCode" class="mui-btn mui-btn-outlined mui-btn-red">未认证</button></span>
			                </div>
						</div>
					</li>
					<li class="mui-table-view-cell">
						<div class="mui-table" id="certified">
							<div class="mui-table-cell mui-col-xs-12">
								<h5>实名认证</h5>
							</div>
							<div class="mui-table-cell mui-col-xs-7 mui-text-right">
			                    <span class="mui-h5" id="realName"></span>
			                    <input type="hidden" id="hiddenRealName" />
			                </div>
							<div class="mui-table-cell mui-col-xs-5 mui-text-right">
			                    <span class="mui-h5"><button type="button" id="btnVerificationName" class="mui-btn mui-btn-outlined mui-btn-red">未认证</button></span>
			                </div>
						</div>
					</li>
					<li class="mui-table-view-cell">
						<div class="mui-table" id="certifiedBankCard">
							<div class="mui-table-cell mui-col-xs-12">
								<h5>银行卡认证</h5>
							</div>
							<div class="mui-table-cell mui-col-xs-7 mui-text-right">
			                    <span class="mui-h5" id="bankCardNumber"></span>
			                    <input type="hidden" id="hiddenBankCardNumber" />
			                </div>
			                <div class="mui-table-cell mui-col-xs-5 mui-text-right">
			                    <span class="mui-h5"><button type="button" id="btnVerificationIdCard" class="mui-btn mui-btn-outlined mui-btn-red">未认证</button></span>
			                </div>
						</div>
					</li>
				</ul>
				<ul class="mui-table-view" style="margin-top: 25px;">
					<li class="mui-table-view-cell" id="mybill">
						<a class="mui-navigate-right">
							<h5>账单中心</h5>
						</a>
					</li>
					<li class="mui-table-view-cell" id="service">
						<a class="mui-navigate-right">
							<h5>客服中心</h5>
						</a>
					</li>
					<li class="mui-table-view-cell" id="announcement">
						<a class="mui-navigate-right">
							<h5>消息中心</h5>
						</a>
					</li>
					<li class="mui-table-view-cell" id="getStarted">
						<a class="mui-navigate-right">
							<h5>新手入门</h5>
						</a>
					</li>
					<!--<li class="mui-table-view-cell" id="hongbao">
						<a class="mui-navigate-right">
							<h5>抢红包</h5>
						</a>
					</li>-->
					<!--<li class="mui-table-view-cell" id="headImage">
						<a class="mui-navigate-right">
							<h5>上传头像</h5>
						</a>
					</li>-->
				</ul>
				<ul class="mui-table-view" style="margin-top: 25px;">
					<li class="mui-table-view-cell" id="weixin">
						<a class="mui-navigate-right">
							<h5 id="weixin">微信账号<input type="hidden" value="" id="hiddenweixin"/></h5>
						</a>
					</li>
					<li class="mui-table-view-cell" id="alipay">
						<a class="mui-navigate-right" id="alipay">
							<h5 id="alipay">支付宝账号<input type="hidden" value="" id="hiddenalipay"/></h5>
						</a>
					</li>
					<li class="mui-table-view-cell" id="virtualwallet">
						<a class="mui-navigate-right" id="virtualwallet">
							<h5>虚拟钱包<input type="hidden" value="" id="hiddenvirtualwallet"/></h5>
						</a>
					</li>
					<li class="mui-table-view-cell" id="loginpwd">
						<a class="mui-navigate-right" id="loginpwd">
							<h5>修改登录密码</h5>
						</a>
					</li>
					<li class="mui-table-view-cell" id="dealpwd">
						<a class="mui-navigate-right" id="dealpwd">
							<h5>修改交易密码</h5>
						</a>
					</li>
				</ul>
				<div id="dropout">
		        	<ul class="mui-table-view" style="margin-top: 25px;">
						<li class="mui-table-view-cell" id="closeApp">
							<a style="text-align: center;color: #FF3B30;">
								退出登录
							</a>
						</li>
					</ul>
		        </div>
				
			</div>
		</div>
	</div>
	<script type="text/javascript" charset="utf-8">
      	mui.init({
      		pullRefresh: {
				container: '#pullrefresh',
				down: {
					height:50,//可选,默认50.触发下拉刷新拖动距离,
			        auto: false,//可选,默认false.首次加载自动下拉刷新一次
			        contentdown : "下拉可以刷新",//可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
			        contentover : "释放立即刷新",//可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
			        contentrefresh : "正在刷新...",//可选，正在刷新状态时，下拉刷新控件上显示的标题内容
					callback: pulldownRefresh
				}/*,
				up: {
					contentrefresh: '正在加载...',
					callback: pullupRefresh
				}*/
			}
      	});
      	
      	/**
		 * 下拉刷新具体业务实现
		 */
		function pulldownRefresh() {
			setTimeout(function() {
				showUserInfo();
				mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
			}, 500);
		}
		mui.plusReady(function(){
			//mui.toast("加载个人设置页面");
			showUserInfo();
			
			mui("#getStarted")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/getStarted.html'
				});
			});
			
			mui("#closeApp")[0].addEventListener('tap',function(event){
				//mui.toast("退出登录");
				//删除本地存储的appToken
				plus.storage.removeItem("appToken");
				plus.webview.currentWebview().opener().close();
			});
			
			mui("#certified")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/certified.html'
				});
			});
			mui("#certifiedBankCard")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/certified.html'
				});
			});
			mui("#mybill")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/mybill.html'
				});
			});
			mui("#service")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/service.html'
				});
			});
			mui("#announcement")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/announcement.html'
				});
			});
			/*mui("#headImage")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/headImage.html'
				});
			});*/
			/*mui("#hongbao")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/hongbao.html',
					id: 'hongbao',
					preload: true,
					show: {
						aniShow: 'pop-in'
					},
					styles: {
						popGesture: 'hide'
					},
					waiting: {
						autoShow: false
					}
				});
			});*/
			mui("#weixin")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/weixin.html',
					extras: {weixin:document.getElementById("hiddenweixin").value} //自定义扩展参数
				});
			});
			mui("#alipay")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/alipay.html',
					extras: {alipay:document.getElementById("hiddenalipay").value} //自定义扩展参数
				});
			});
			mui("#virtualwallet")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/virtualwallet.html',
					extras: {virtualwallet:document.getElementById("hiddenvirtualwallet").value} //自定义扩展参数
				});
			});
			mui("#loginpwd")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/loginpwd.html'
				});
			});
			mui("#dealpwd")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'settings/dealpwd.html'
				});
			});
		});
		function showUserInfo(){
			mui.ajax(url + '/userInfo',{
				dataType:'json',//服务器返回json格式数据
				type:'get',//HTTP请求类型
				headers:{'Content-Type':'application/json'},
				crossDomain:true,
				success:function(data){
					//服务器返回响应，根据响应结果，分析是否登录成功；
					console.log("------------->data = " + data);
					console.log("------------->data.resultCode = " + data.resultCode);
					console.log("------------->data.resultMsg = " + data.resultMsg);
					console.log("------------->data.appToken = " + data.appToken);
					console.log("------------->data.machines = " + data.machines);
					//判断本地存储的appToken是否和服务器的appToken相同
					checkAppToken(data.appToken);
					if(data.resultCode == '1001'){
						document.getElementById("parentUserNo").innerText = data.userInfo.parentUserNo;
						document.getElementById("userNo").innerText = data.userInfo.userNo;
						document.getElementById("level").innerText = data.userInfo.levelStr;
						document.getElementById("mobileNo").innerText = data.userInfo.mobileNo;
						if(data.userInfo.mobileNo != ''){
							document.getElementById("btnVerificationCode").innerHTML = "已认证";
							document.getElementById("btnVerificationCode").classList.remove("mui-btn-red");
							document.getElementById("btnVerificationCode").classList.add("mui-btn-green");
						}
						document.getElementById("realName").innerText = data.userInfo.realName;
						if(data.userInfo.realName != ''){
							document.getElementById("btnVerificationName").innerText = "已认证";
							document.getElementById("btnVerificationName").classList.remove("mui-btn-red");
							document.getElementById("btnVerificationName").classList.add("mui-btn-green");
						}
						document.getElementById("bankCardNumber").innerText = data.userInfo.accountBank;
						if(data.userInfo.accountBank != ''){
							document.getElementById("btnVerificationIdCard").innerHTML = "已认证";
							document.getElementById("btnVerificationIdCard").classList.remove("mui-btn-red");
							document.getElementById("btnVerificationIdCard").classList.add("mui-btn-green");
						}
						document.getElementById("hiddenweixin").value = data.userInfo.weixin;
						document.getElementById("hiddenvirtualwallet").value = data.userInfo.virtualWallet;
						document.getElementById("hiddenalipay").value = data.userInfo.alipay;
						document.getElementById("virtualCoinCount").innerText = data.userInfo.virtualCoinCount;
						document.getElementById("availableCount").innerText = data.userInfo.availableCount;
						document.getElementById("freezeCount").innerText = data.userInfo.freezeCount;
					}else if(data.resultCode == '1004'){
  						mui.toast(data.resultMsg);
  						return;
					}
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
					mui.toast("系统异常！");
					console.log("异常: " + type);
				}
			});
		}
    </script>
</body>
</html>