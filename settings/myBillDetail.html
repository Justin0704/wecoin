<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>账单中心</title>
    <link href="../css/mui.min.css" rel="stylesheet"/>
    <link href="../css/app.css" rel="stylesheet"/>
    <style type="text/css">
    	.mui-control-content {
			background-color: white;
			min-height: 500px;
		}
		.mui-control-content .mui-loading {
			margin-top: 50px;
		}
		.mui-bar{background-color: #108EE9;height: 65px;}
			.mui-title{color: #FFFFFF;line-height: 75px;}
			.mui-bar .mui-icon{padding-top: 25px;}
			.mui-bar .mui-btn-link {line-height: 75px;}
    	.mui-row{background-color: #108EE9;}
		.mui-bar .mui-action-back{color: #FFFFFF;}
		.mui-bar .mui-title{color: #FFFFFF;}
		.mui-bar #myBillCenter{color: #FFFFFF;}
    </style>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
		<h1 class="mui-title">明细</h1>
	</header>
	<div class="mui-content" style="padding-top: 65px;">
		<div class="mui-navbar-inner mui-bar mui-bar-nav">
			<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
				<span class="mui-icon mui-icon-left-nav"></span>
			</button>
			<h1 class="mui-center mui-title">明细</h1>
			<a class="mui-icon mui-icon-bars mui-pull-right" id="myBillCenter"></a>
		</div>
		<div id="item1mobile">
		</div>
	</div>
	<script src="../js/mui.min.js"></script>
	<script type="text/javascript" src="../js/header.js" ></script>
    <script type="text/javascript" src="../js/appToken2.js" ></script>
	<script type="text/javascript" charset="utf-8">
      	mui.init({
      		swipeBack:true
      	});
      	var item1 = document.getElementById('item1mobile');
  		
      	(function($){
      		//plus.ui.toast("进入账单中心");
      		$('.mui-scroll-wrapper').scroll({
      			indicators: true //是否显示滚动条
      		});
      		queryRevenues();
      		
      		mui("#myBillCenter")[0].addEventListener('tap',function(event){
				mui.openWindow({
					url: 'mybill.html'
				});
			});
      	})(mui);
      	function queryRevenues(){
      		plus.nativeUI.showWaiting('正在查询，请稍后...');
      		mui.ajax(url + '/allRevenues',{
				dataType:'json',//服务器返回json格式数据
				type:'get',//HTTP请求类型
				headers:{'Content-Type':'application/json'},
				crossDomain:true,
				success:function(data){
					//服务器返回响应，根据响应结果，分析是否登录成功；
					console.log("------------->data = " + data);
					console.log("------------->data.resultCode = " + data.resultCode);
					console.log("------------->data.resultMsg = " + data.resultMsg);
					console.log("------------->data.appToken = " + data.appToken);
					plus.nativeUI.closeWaiting();
					//判断本地存储的appToken是否和服务器的appToken相同
					checkAppToken(data.appToken);
					
					if(data.resultCode == '1001'){
						//plus.ui.toast("查询矿机列表成功");
						//把appToken保存到本地
						//plus.storage.setItem('appToken',data.appToken);
						//查询成功，把列表显示到页面
						var html = '<ul class="mui-table-view">';
						for(var i in data.revenueList){
							if(data.revenueList[i].revenueType === 3 || data.revenueList[i].revenueType === 5){
								html += '<li class="mui-table-view-cell"><div class="mui-table"><div class="mui-table-cell mui-col-xs-10"><h4 class="mui-ellipsis">'+data.revenueList[i].revenueTypeStr+'</h4><h5>'+data.revenueList[i].revenueTimeStr+'</h5></div><div class="mui-table-cell mui-col-xs-2 mui-text-right"><span class="mui-h5">-'+data.revenueList[i].revenue+'</span></div></div></li>';
							}else{
								html += '<li class="mui-table-view-cell"><div class="mui-table"><div class="mui-table-cell mui-col-xs-10"><h4 class="mui-ellipsis">'+data.revenueList[i].revenueTypeStr+'</h4><h5>'+data.revenueList[i].revenueTimeStr+'</h5></div><div class="mui-table-cell mui-col-xs-2 mui-text-right"><span class="mui-h5">+'+data.revenueList[i].revenue+'</span></div></div></li>';
							}
						}
						html += '</ul>';
						item1.innerHTML = html;
					}else if(data.resultCode = '6001'){
						mui.toast(data.resultMsg);
					}else if(data.resultCode = '1004'){
						mui.toast(data.resultMsg);
					}
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();
					//异常处理；
					mui.toast("系统异常！");
					console.log("异常: " + type);
				}
			});
      	}
    </script>
</body>
</html>